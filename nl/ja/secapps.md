---

copyright:
  years: 2015, 2019
lastupdated: "2019-07-25"

keywords: apps, application, ssl, certificates, access, restrict access, create, csr, upload, import

subcollection: creating-apps

---

{:shortdesc: .shortdesc}
{:tip: .tip}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}
{:note: .note}

# 証明書署名要求の作成
{: #ssl_csr}

SSL 証明書をアップロードし、アプリへのアクセスを制限することにより、アプリケーションを保護することができます。
{: shortdesc}

## 証明書署名要求の作成
{: #create_csr}

{{site.data.keyword.cloud}} で許可された SSL 証明書をアップロードするには、その前にご使用のサーバーで証明書署名要求 (CSR) を作成しなければなりません。 CSR というのは、公開鍵と関連情報への署名を要求するために認証局に送信されるメッセージのことです。 通常、CSR は PKCS #10 フォーマットになっています。 CSR には、公開鍵、共通名、組織、市区町村、都道府県、国、および E メールが組み込まれています。 SSL 証明書要求は、2048 ビット長の CSR 鍵を使用した場合のみ受理されます。

CSR の作成方法は、ご使用のオペレーティング・システムによって様々です。 以下の例は、[OpenSSL コマンド・ライン・ツール ](https://www.openssl.org/){: new_window} ![外部リンク・アイコン](../icons/launch-glyph.svg "外部リンク・アイコン")を使用して CSR を作成する方法を示しています。

```
openssl req -out CSR.csr -new -newkey rsa:2048 -nodes -keyout privatekey.key
```
{: codeblock}

OpenSSL SHA-512 が実装されるかどうかは、コンパイラーが 64 ビットの整数型をサポートしているかどうかで決まります。 SHA-256 の証明書に関して互換性の問題があるアプリでは、SHA-1 オプションを使用してかまいません。
{: tip}

### 必要な CSR の内容

CSR を有効にするには、CSR の作成時に以下の情報を入力する必要があります。

 * **国名 (Country name)**: 国または地域の 2 桁のコード。 例えば、`US` は米国の国別コードです。 他の国や地域については、CSR を作成する前に、[ISO 国別コードのリスト ](https://www.iso.org/obp/ui/#search){: new_window} ![外部リンク・アイコン](../icons/launch-glyph.svg "外部リンク・アイコン")を調べてください。
 * **都道府県**: 短縮されていない正式な都道府県の名称。
 * **市区町村 (Locality)**: 市区町村の正式名称。
 * **組織**: その地域で法的に登録された法人もしくは企業の正式名称または個人名。 企業の場合は、必ず組織形態名 (Ltd.、Inc.、NV. など) を含めてください。
 * **組織単位 (Organization unit)**: 証明書を申請している会社の (経理や営業などの) 部門名。
 * **共通名**: SSL 証明書の要求先サイトの完全修飾ドメイン名 (FQDN)。

サブジェクトの代替名 (SAN) を使用できますが、CN の衝突を防ぐために、提供されたホスト名を他のデプロイ済み証明書で発行してはなりません。
{: note}

証明書は認証局によって発行され、その認証局によってデジタル署名されています。 CSR の作成後は、パブリック認証局に SSL 証明書を生成できます。

## SSL 証明書のアップロード
{: #ssl_certificate}

セキュリティー・プロトコルを適用して、アプリの通信におけるプライバシーを提供することで、盗聴、不正アクセス、およびメッセージ偽造を防止することができます。 ライト・アカウントを持っている場合、証明書をアップロードするにはアカウントをアップグレードする必要があります。

期限切れまたは期限切れが近い証明書を更新する必要がある場合は、新しい証明書の準備ができた後に、既存の証明書を削除してから新しい証明書を追加します。
{: note}

カスタム・ドメインを使用して SSL 証明書を提供する場合、以下の地域エンドポイントを使用して、{{site.data.keyword.cloud_notm}} の組織の URL 経路を指定します。

| 地域 | エンドポイント |
| ------ | -------- |
| 米国南部 | `custom-domain.us-south.cf.cloud.ibm.com` |
| 米国東部 | `custom-domain.us-east.cf.cloud.ibm.com` |
| EU-DE | `custom-domain.eu-de.cf.cloud.ibm.com` |
| EU-GB | `custom-domain.eu-gb.cf.cloud.ibm.com` |
| AU-SYD | `custom-domain.au-syd.cf.cloud.ibm.com` | 
{: caption="表 1. Cloud Foundry カスタム・ドメインの地域エンドポイント" caption-side="top"}

Cloud Foundry アプリの証明書をアップロードするには、以下のステップを実行します。

1. [{{site.data.keyword.cloud_notm}} コンソール![外部リンク・アイコン](../icons/launch-glyph.svg "外部リンク・アイコン")](https://{DomainName}){: new_window}から**「メニュー」**アイコン![「メニュー」アイコン](../icons/icon_hamburger.svg)をクリックして**「リソース・リスト」**を選択します。
2. **「Cloud Foundry アプリ」**をクリックします。
3. ドメインを変更するアプリをクリックします。 
4. アプリの「概要」ページで、**「経路」**をクリックし、**「ドメインの管理」**を選択します。
5. 「アクション」列で、「アクション」アイコン ![「その他のアクション」アイコン](../icons/action-menu-icon.svg)をクリックし、**「ドメイン」**を選択します。
6. カスタム・ドメインの**「アップロード」**をクリックします。
7. オプションを選択し、ファイルをアップロードして、**「追加」**をクリックします。
  
  * 証明書: 公開鍵を証明書所有者の ID にバインドして証明書の所有者を認証できるようにするデジタル文書。 証明書は認証局によって発行され、その認証局によってデジタル署名されています。 証明書は通常、認証局によって発行および署名されます。 ただし、テストおよび開発目的では、自己署名証明書を使用することができます。
  * 秘密鍵: 対応する公開鍵のみが復号できるメッセージを暗号化するために使用される算法パターン。 秘密鍵は、対応する公開鍵によって暗号化されたメッセージの暗号化解除にも使用されます。 秘密鍵はユーザーのシステム上に保持され、パスワードによって保護されています。
  * 中間証明書 (オプション): 特にエンド・エンティティー・サーバー証明書を発行する目的で、トラステッド・ルート認証局 (CA) によって発行される、従属証明書。 その結果として、トラステッド・ルート CA から始まり、中間証明書を経て、組織に発行される SSL 証明書に至る、証明書チェーンが形成されます。 中間証明書を使用して、メイン証明書の認証性を検証します。 中間証明書は通常、信頼のおける第三者機関から取得します。 アプリを実動環境にデプロイする前にテストする際には、中間証明書が不要な場合もあります。
  * クライアント証明書の要求の有効化: このオプションを有効にすると、SSL で保護されたドメインにアクセスしようとするユーザーは、クライアント側の証明書を提供するよう要求されます。 例えば、Web ブラウザーでユーザーが SSL で保護されたドメインにアクセスしようとすると、Web ブラウザーは、そのドメインのクライアント証明書を提供するようユーザーにプロンプトを出します。   
  * クライアント証明書トラストストア (オプション): アプリへのアクセスが許可されるユーザー用のクライアント証明書が含まれています。 クライアント証明書を要求するオプションを有効にするには、クライアント証明書トラストストア・ファイルをアップロードします。
  
    メタデータに公開鍵を含んでいるクライアント証明書トラストストアをアップロードすることで、相互認証をセットアップできます。
    {: tip}


